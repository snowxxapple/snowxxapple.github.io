<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>我的日志</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
    .righticon {
        margin-top: 18px;
    }
    
    .box1 {
        width: 100%;
        height: 749px;
        margin: 0px;
        padding: 0px;
        z-index: -1;
        background: url(img/b4.jpg);
    }
    
    .sbj {
        padding-top: 30px;
    }
    
    .back-color {
        margin: 5px;
    }
    
    a {
        cursor: pointer;
    }
    </style>
</head>

<body style='padding-top:50px;'>
    <nav class='navbar navbar-default navbar-fixed-top' role='navigation'>
        <div class="container">
            <div class='navbar-header' style='width:150px;'>
                <img src="img/1.jpg" class='img-circle navbar-brand' style='padding:0px'>
                <p style='margin-top:15px;'>小雪喜欢下雪天</p>
            </div>
            <ul class='nav navbar-nav pull-right'>
                <li><a href="xxblog.html">首页</a></li>
                <li><span class="glyphicon glyphicon-menu-right righticon"></span></li>
                <li><a href="xxblog.html#life1">爱生活</a></li>
                <li><span class="glyphicon glyphicon-menu-right righticon"></span></li>
                <li><a href='xxblog.html#life2'>心情日志</a></li>
                <li><span class="glyphicon glyphicon-menu-right righticon"></span></li>
                <li><a><strong>我的日志</strong></a></li>
            </ul>
        </div>
    </nav>
    <div class='box1'>
        <div class="container">
            <div class="row">
                <div class="col-md-3 sbj" style='padding-left:0px;padding-right:0px;'>
                    <div class="row">
                        <div class="col-md-10">
                            <ul class='list-group' style='text-align:center;'>
                                <li class='list-group-item'>
                                    <h5><strong>日志列表</strong><span class='badge' style='background:#cce;margin-left:10px;'>12</span></h5>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-9 sbj">
                    <div class="row">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <span id='diary-head'></span>
                                <span class='pull-right back-color' style='height:15px;width:15px;background:url(img/diary-back/back.jpg);background-repeat:no repeat;background-position:-60px 0px;outline: solid 2px #aaaaaa;'></span>
                                <span class='pull-right back-color' style='height:15px;width:15px; background:url(img/diary-back/back.jpg);background-repeat:no repeat;background-position:-45px 0px;outline: solid 2px #aaaaaa;'></span>
                                <span class='pull-right back-color' style='height:15px;width:15px;background:url(img/diary-back/back.jpg);background-repeat:no repeat;background-position:-30px 0px;outline: solid 2px #aaaaaa;'></span>
                                <span class='pull-right back-color' style='height:15px;width:15px;background:url(img/diary-back/back.jpg);background-repeat:no repeat;background-position:-15px 0px;outline: solid 2px #aaaaaa;'></span>
                                <span class='pull-right back-color' style='height:15px;width:15px; background:url(img/diary-back/back.jpg);background-repeat:no repeat;background-position:0px 0px;outline: solid 2px #aaaaaa;'></span>
                                <span class='pull-right back-color' style='height:15px;width:15px;background:white;outline: solid 2px #aaaaaa;'></span>
                                <span class='pull-right back-color'>背景:</span>
                            </div>
                            <div class='panel-body' style='padding:0px;'>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-2.1.4.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
window.onload = function() {
    var oBack = document.getElementsByClassName('pull-right back-color');
    var oLi = document.getElementsByClassName('list-group-item');
    $.ajax({ //加载日志列表
            url: 'diarylist.json',
            type: 'GET',
            dataType: 'json',

        })
        .done(function(dylist) {
            console.log("success");

            for (j = 1; j < dylist.list.length; j++) {
                $('.list-group').append("<li class='list-group-item'><a class='file-name'>" + dylist.list[j - 1].name + "</a></li>"); //append在所选元素的内部，追加内容
               var oFileName = document.getElementsByClassName('file-name');
               oFileName[0].style.fontWeight=700;
            };

        })
    $.ajax({ //加载日志内容，即日志面板里的内容，这里为初始界面，即显示第一篇日志
            url: 'diary.json',
            type: 'GET',
            dataType: 'json',
        })
        .done(function(file) {
            console.log("success");
            $('#diary-head').html(file.diary[0].name);
            $('.panel-body').append("<div style='height:570px;overflow:auto;padding:10px;padding-left:18px;' class='diary-back'><p id='content'>" + file.diary[0].content + "</p></div>");
            var oDiaryBack = document.getElementsByClassName('diary-back')[0];
            if (localStorage.getItem(21) == null) {//判断localstorage21是否存在，若不存在，则给日志赋予背景
                oDiaryBack.style.background = 'url(img/diary-back/1.jpg)';
            } 
            else {
                oDiaryBack.style.background = localStorage.getItem(21);
            }
            for (n = 0; n < oBack.length; n++) { //所有的日志背景都是一样的
                oBack[n].index = n;
                var oDiaryBack = document.getElementsByClassName('diary-back')[0];
                oBack[n].onclick = function() {
                    if (this == oBack[5]) {
                        oDiaryBack.style.background = 'white';
                    } else {
                        oDiaryBack.style.background = 'url(img/diary-back/' + (oBack.length - this.index - 2) + '.jpg)';
                    }
                    localStorage.setItem(21, oDiaryBack.style.background);
                }
            }
            for (m = 1; m < oLi.length; m++) //序号为0的是日志列表的表头,该循环为点击列表里的日志名称，会相应的在日志面板里面显示日志内容
            {
                oLi[m].index = m - 1;
                var oFileName = document.getElementsByClassName('file-name');
                oLi[m].onclick = function() {
                    var that = this; //必须要把当前的this存下来，不能再下面ajax中直接用this
                    for (p = 0; p < oFileName.length; p++) {
                        oFileName[p].style.fontWeight = 400;
                    }
                    oFileName[this.index].style.fontWeight = 700;
                    $.ajax({
                            url: 'diary.json',
                            type: 'GET',
                            dataType: 'json',
                        })
                        .done(function(file) {
                            console.log("success");
                            $('#diary-head').html(file.diary[that.index].name);
                            $('#content').html(file.diary[that.index].content);
                        })
                }
            }
        })
}
</script>

</html>
